{"version":3,"sources":["components/ConfigScreen.tsx","components/api/sendgrid.ts","components/Field.tsx","index.tsx"],"names":["Config","props","onConfigure","a","sdk","app","getCurrentState","currentState","parameters","state","targetState","handleApiKeyChange","event","console","log","target","value","setState","apikey","this","getParameters","setReady","className","css","margin","width","required","name","id","labelText","onChange","helpText","Component","cache","setupCache","maxAge","api","axios","create","adapter","Field","installation","useState","field","getValue","current","setCurrent","templates","setTemplates","filteredItems","setFilteredItems","useEffect","method","url","headers","authorization","params","language_code","then","response","data","result","map","catch","error","fetchData","handleQueryChange","useCallback","query","matches","filter","item","keywords","split","keyword","expression","RegExp","join","match","length","maxHeight","onQueryChange","items","setValue","isLoading","options","option","noteType","init","root","document","getElementById","location","locations","LOCATION_APP_CONFIG","component","LOCATION_ENTRY_FIELD","forEach","componentLocationSetting","is","render"],"mappings":"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","file":"static/js/main.8012225d.chunk.js","sourcesContent":["import React, { Component } from \"react\"\nimport { AppExtensionSDK } from \"@contentful/app-sdk\"\nimport {\n  Heading,\n  Form,\n  Workbench,\n  Paragraph,\n  TextField,\n  FieldGroup,\n} from \"@contentful/forma-36-react-components\"\nimport { css } from \"emotion\"\n\nexport interface AppInstallationParameters {\n  apikey?: any\n}\n\ninterface ConfigProps {\n  sdk: AppExtensionSDK\n}\n\ninterface ConfigState {\n  parameters: AppInstallationParameters\n}\n\nexport default class Config extends Component<ConfigProps, ConfigState> {\n  constructor(props: ConfigProps) {\n    super(props)\n    this.state = { parameters: { apikey: ''} }\n\n    // `onConfigure` allows to configure a callback to be\n    // invoked when a user attempts to install the app or update\n    // its configuration.\n    props.sdk.app.onConfigure(() => this.onConfigure())\n  }\n\n  async componentDidMount() {\n    // Get current parameters of the app.\n    // If the app is not installed yet, `parameters` will be `null`.\n    const parameters: AppInstallationParameters | null = await this.props.sdk.app.getParameters()\n\n    this.setState(parameters ? { parameters } : this.state, () => {\n      // Once preparation has finished, call `setReady` to hide\n      // the loading screen and present the app to a user.\n      this.props.sdk.app.setReady()\n    })\n  }\n\n  onConfigure = async () => {\n    // This method will be called when a user clicks on \"Install\"\n    // or \"Save\" in the configuration screen.\n    // for more details see https://www.contentful.com/developers/docs/extensibility/ui-extensions/sdk-reference/#register-an-app-configuration-hook\n\n    // Get current the state of EditorInterface and other entities\n    // related to this app installation\n    const currentState = await this.props.sdk.app.getCurrentState()\n\n    return {\n      // Parameters to be persisted as the app configuration.\n      parameters: this.state.parameters,\n      // In case you don't want to submit any update to app\n      // locations, you can just pass the currentState as is\n      targetState: currentState,\n    }\n  }\n\n  handleApiKeyChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const { parameters } = this.state;\n    console.log(event.target.value)\n    this.setState({ parameters: {\n      ...parameters,\n      apikey: event.target.value\n    }});\n  }\n\n\n  render() {\n    return (\n      <Workbench className={css({ margin: \"80px\" })}>\n        <Form\n          className={css({ width: \"100%\" })}\n        >\n          <FieldGroup className={css({ width: \"50%\" })}>\n            <Heading>App Config</Heading>\n            <Paragraph>\n              Welcome to your contentful app. This is your config page.\n            </Paragraph>\n            <TextField\n              required\n              name=\"apikey\"\n              id=\"apikey\"\n              labelText=\"Sendgrind API Key\"\n              value={this.state.parameters.apikey}\n              onChange={this.handleApiKeyChange}\n              helpText=\"Provide Sendgrid API Key\"\n            />\n          </FieldGroup>\n        </Form>\n      </Workbench>\n    )\n  }\n}\n","import axios from \"axios\"\nimport { setupCache } from \"axios-cache-adapter\"\n\nexport interface Item {\n  id: string\n  name: string\n}\nconst cache = setupCache({\n  maxAge: 60 * 1000,\n})\n\nconst api = axios.create({\n  adapter: cache.adapter,\n})\n\nexport const getTemplates = (key: string): Promise<Item[]> =>\n  api({\n    method: \"GET\",\n    url:\n      \"https://api.sendgrid.com/v3/templates?page_size=200&generations=dynamic\",\n    headers: {\n      \"content-type\": \"application/octet-stream\",\n      authorization: `bearer ${key}`,\n    },\n    params: {\n      language_code: \"en\",\n    },\n  })\n    .then((response: any) => {\n      return response.data.result.map(\n        ({ id, name }: { id: string; name: string }) => ({ id, name })\n      )\n    })\n    .catch((error: any) => [])\n","import React, { useState, useEffect, useCallback } from \"react\"\nimport {\n  Autocomplete,\n  Note,\n  HelpText,\n  Heading,\n} from \"@contentful/forma-36-react-components\"\nimport { FieldExtensionSDK } from \"@contentful/app-sdk\"\nimport { Item, getTemplates } from \"./api/sendgrid\"\n\ninterface FieldProps {\n  sdk: FieldExtensionSDK\n}\ninterface Parameters {\n  apikey?: string\n}\n\nconst Field = (props: FieldProps) => {\n  const { sdk } = props\n  const { apikey }: Parameters = sdk.parameters.installation\n\n  // If you only want to extend Contentful's default editing experience\n  // reuse Contentful's editor components\n  // -> https://www.contentful.com/developers/docs/extensibility/field-editors/\n\n  const [current, setCurrent] = useState<Item>({\n    id: sdk.field.getValue(),\n    name: \"\",\n  })\n  const [templates, setTemplates] = useState<Item[]>([])\n  const [filteredItems, setFilteredItems] = useState<Item[]>(templates)\n\n  useEffect(() => {\n    const fetchData = async () => {\n      if (apikey) {\n        const templates = await getTemplates(apikey)\n        setTemplates(templates)\n        setFilteredItems(templates)\n      }\n    }\n    fetchData()\n  }, [apikey])\n\n  const handleQueryChange = useCallback(\n    (query: string) => {\n      const matches = query\n        ? templates.filter(\n            (item) => {\n              const keywords = query.split(\" \").filter((keyword) => keyword)\n              const expression = new RegExp(keywords.join(\".*\"), \"ig\")\n              const matches = item.name.match(expression) || []\n              return matches.length\n            }\n            // item.name.toLowerCase().includes(query.toLowerCase())\n          )\n        : templates\n      setFilteredItems(matches)\n    },\n    [setFilteredItems, templates]\n  )\n\n  return (\n    <>\n      <Autocomplete<Item>\n        maxHeight={90}\n        onQueryChange={handleQueryChange}\n        items={filteredItems}\n        // onChange={()=>{}}\n        onChange={({ id, name }) => {\n          sdk.field.setValue(id)\n          setCurrent({ id, name })\n        }}\n        isLoading={templates.length === 0}\n      >\n        {(options: Item[]) =>\n          options.map((option: Item) => (\n            <span key={option.id}>{option.name}</span>\n          ))\n        }\n      </Autocomplete>\n\n      <Note noteType=\"positive\">\n        <HelpText>\n          {templates.filter(({ id }) => id === sdk.field.getValue())[0]?.name}\n        </HelpText>\n        <Heading>{current.id}</Heading>\n      </Note>\n    </>\n  )\n}\n\nexport default Field\n","import React from 'react';\nimport { render } from 'react-dom';\n\nimport {\n  AppExtensionSDK,\n  FieldExtensionSDK,\n  init,\n  locations,\n} from '@contentful/app-sdk';\nimport '@contentful/forma-36-react-components/dist/styles.css';\nimport '@contentful/forma-36-fcss/dist/styles.css';\nimport '@contentful/forma-36-tokens/dist/css/index.css';\nimport './index.css';\n\nimport Config from './components/ConfigScreen';\nimport Field from './components/Field';\n\nimport LocalhostWarning from './components/LocalhostWarning';\n\nif (process.env.NODE_ENV === 'development' && window.self === window.top) {\n  // You can remove this if block before deploying your app\n  const root = document.getElementById('root');\n  render(<LocalhostWarning />, root);\n} else {\n  init((sdk) => {\n    const root = document.getElementById('root');\n\n    // All possible locations for your app\n    // Feel free to remove unused locations\n    // Dont forget to delete the file too :)\n    const ComponentLocationSettings = [\n      {\n        location: locations.LOCATION_APP_CONFIG,\n        component: <Config sdk={sdk as AppExtensionSDK} />,\n      },\n      {\n        location: locations.LOCATION_ENTRY_FIELD,\n        component: <Field sdk={sdk as FieldExtensionSDK} />,\n      },\n    ];\n\n    // Select a component depending on a location in which the app is rendered.\n    ComponentLocationSettings.forEach((componentLocationSetting) => {\n      if (sdk.location.is(componentLocationSetting.location)) {\n        render(componentLocationSetting.component, root);\n      }\n    });\n  });\n}\n"],"sourceRoot":""}